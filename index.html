<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AIvest ‚Äî —É—á–∏—Å—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</title>

  <style>
    :root{
      --bg-light: linear-gradient(to bottom, #f9fafb, #e5e7eb);
      --bg-dark: linear-gradient(to bottom, #0b1220, #071026);
      --card-light: #fff;
      --card-dark: #0f1724;
      --accent: #2563eb;
      --muted: #6b7280;
      --text-light: #0f172a;
      --text-dark: #e6eefc;
    }

    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background .35s, color .35s;
      overflow-x:hidden;
    }

    /* Dark mode class toggles these */
    body.dark{
      background: var(--bg-dark);
      color: var(--text-dark);
    }

    a{color:inherit;text-decoration:none}
    button{cursor:pointer}

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      padding:1rem 1.25rem;
      background: var(--card-light);
      box-shadow: 0 2px 8px rgba(2,6,23,0.06);
      position:sticky;
      top:0;
      z-index:50;
      transition: background .35s, color .35s;
    }
    body.dark header{ background: var(--card-dark); box-shadow: 0 2px 8px rgba(0,0,0,0.6); }

    .brand { font-weight:700; color:var(--accent); font-size:1.25rem; }
    nav ul{ display:flex; gap:1rem; list-style:none; padding:0; margin:0; align-items:center; }
    nav a{ color:inherit; padding:.35rem .6rem; border-radius:.5rem; }
    nav a:hover{ background: rgba(37,99,235,0.08) }

    /* Shared button style */
    .btn {
      background: var(--accent);
      color:#fff;
      border:none;
      padding:0.5rem 0.9rem;
      border-radius:0.6rem;
      font-weight:600;
      transition: transform .15s, background .15s;
    }
    .btn:hover{ transform:translateY(-2px); background:#1e40af }

    /* Burger */
    .burger{ display:none; gap:5px; cursor:pointer }
    .burger span{ width:22px; height:3px; background:currentColor; border-radius:3px; display:block }

    @media (max-width:780px){
      nav ul{ display:none; position:absolute; right:1rem; top:64px; flex-direction:column; background:var(--card-light); padding:.75rem; border-radius:.75rem; box-shadow:0 8px 24px rgba(2,6,23,0.12) }
      body.dark nav ul{ background:var(--card-dark) }
      nav ul.active{ display:flex; }
      .burger{ display:flex }
    }

    /* Hero */
    .hero{
      text-align:center;
      padding:5.25rem 1.25rem;
      background: linear-gradient(90deg, rgba(191,219,254,0.8), rgba(224,242,254,0.8));
      border-bottom-left-radius: 1.75rem;
      border-bottom-right-radius: 1.75rem;
      overflow:hidden;
      position:relative;
    }
    body.dark .hero{ background: linear-gradient(90deg, rgba(14,40,80,0.6), rgba(6,18,35,0.6)); }
    .hero h1{ font-size:2.5rem; margin:0 0 .6rem; color:#102a66; }
    body.dark .hero h1{ color:#a9d2ff }
    .hero .typing{ display:inline-block; font-size:1.05rem; color:var(--muted); white-space:nowrap; border-right:3px solid var(--accent); padding-right:.5rem; height:1.25rem; vertical-align:middle; }
    body.dark .hero .typing{ color: #cfe8ff; border-color:#93c5fd }

    .hero p{ max-width:780px; margin:.9rem auto 1.4rem; color: #17375e }
    body.dark .hero p{ color:#cfe8ff }

    .hero .cta { margin-top: .6rem; }

    /* Features grid */
    .features{
      max-width:1100px; margin:2.25rem auto; padding:0 1rem;
      display:grid; gap:1.25rem; grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
    }
    .card{
      background:var(--card-light);
      border-radius:1.25rem; padding:1.25rem; box-shadow:0 6px 20px rgba(2,6,23,0.06);
      transition: transform .25s, box-shadow .25s, background .3s;
      opacity:0; transform: translateY(24px);
    }
    body.dark .card{ background: var(--card-dark) }
    .card.visible{ opacity:1; transform: translateY(0); transition: all .6s cubic-bezier(.2,.9,.3,1) }
    .card h3{ margin:.6rem 0; color:#102a66 } body.dark .card h3{ color:#bfe0ff }
    .card p{ color:var(--muted) } body.dark .card p{ color:#cbd5e1 }

    /* footer */
    footer{ text-align:center; padding:1.25rem; background:#102a66; color:#fff; margin-top:2.5rem; border-top-left-radius:8px; border-top-right-radius:8px }
    body.dark footer{ background:#07102a }

    /* Floating emojis */
    .emoji{
      position:fixed; pointer-events:none; z-index:5; opacity:.9; transform:translateY(20vh);
      filter: drop-shadow(0 6px 12px rgba(2,6,23,0.12));
      will-change: transform, opacity;
      font-size:1.6rem;
    }

    /* Chat UI */
    .chat-button{
      position:fixed; right:20px; bottom:20px; width:60px; height:60px; border-radius:50%;
      border:none; background:var(--accent); color:#fff; font-size:1.5rem;
      box-shadow: 0 8px 24px rgba(37,99,235,0.18); z-index:120; display:flex; align-items:center; justify-content:center;
    }
    .chat-window{
      position:fixed; right:20px; bottom:96px; width:340px; max-height:560px; display:flex; flex-direction:column;
      border-radius:12px; overflow:hidden; box-shadow:0 12px 36px rgba(2,6,23,0.18); background:var(--card-light);
      z-index:120; transition: transform .25s, opacity .25s;
    }
    body.dark .chat-window{ background: var(--card-dark) }
    .chat-header{ padding:.8rem; background:var(--accent); color:#fff; display:flex; align-items:center; justify-content:space-between; gap:.5rem }
    .chat-messages{ padding:.75rem; overflow-y:auto; flex:1; background:transparent; }
    .chat-input{ display:flex; gap:.25rem; padding:.6rem; border-top:1px solid rgba(2,6,23,0.06) }
    .chat-input input{ flex:1; padding:.6rem .75rem; border-radius:8px; border:1px solid rgba(2,6,23,0.08); outline:none}
    .chat-input button{ background:var(--accent); color:#fff; border:none; padding:.5rem .8rem; border-radius:8px }
    .msg{ margin:6px 0; max-width:82%; padding:.5rem .7rem; border-radius:12px; line-height:1.25; font-size:.95rem }
    .msg.user{ background: rgba(56,189,248,0.12); margin-left:auto; color:var(--text-light) }
    .msg.bot{ background: rgba(243,244,246,0.9); margin-right:auto; color:var(--text-light) }
    body.dark .msg.bot{ background: rgba(255,255,255,0.04) }

    .small{ font-size:.78rem; color:var(--muted); display:block; margin-top:.35rem }
    .controls{ display:flex; gap:.5rem; align-items:center }
    .tiny { background:transparent; border:none; color:#fff; font-weight:700; cursor:pointer }

    @media (max-width:420px){
      .chat-window{ width:92%; right:4%; bottom:88px }
    }

  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div style="display:flex;align-items:center;gap:.75rem">
      <div class="brand">AIvest</div>
      <nav>
        <ul id="navList">
          <li><a href="functions.html">–§—É–Ω–∫—Ü–∏–∏</a></li>
          <li><a href='about.html'>–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
          <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
        </ul>
      </nav>
    </div>

    <div style="display:flex;align-items:center;gap:.5rem">
      <button id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" class="tiny">üåô</button>
      <button class="burger" id="burger" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" title="–ú–µ–Ω—é">
        <span></span><span></span><span></span>
      </button>
      <button class="btn" onclick="window.location.href='lessons.html'">–í—ã–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
      <button class="btn" onclick="window.location.href='invest.html'">–°–∏–º—É–ª—è—Ç–æ—Ä –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" aria-labelledby="heroTitle">
    <h1 id="heroTitle">–£—á–∏—Å—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å AI</h1>
    <div>
      <span class="typing" id="typing"></span>
    </div>
    <p style="max-width:820px;margin:.9rem auto 1.25rem;color:#153059">
      –°–∏–º—É–ª–∏—Ä—É–π –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ª—É—á–∞–π –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã ‚Äî –≤—Å—ë —ç—Ç–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
    </p>
    <div class="cta">
      <button class="btn" onclick="window.location.href='lessons.html'">–ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
    </div>
  </section>

  <!-- FEATURES -->
  <main>
    <section id="features" class="features" aria-label="–§—É–Ω–∫—Ü–∏–∏">
      <div class="card">
        <div style="font-size:2rem">üìä</div>
        <h3>–î–∞—à–±–æ—Ä–¥</h3>
        <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –ø—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.</p>
      </div>
      <div class="card">
        <div style="font-size:2rem">ü§ñ</div>
        <h3>AI-–ø—Ä–æ–≥–Ω–æ–∑</h3>
        <p>–ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ 7 –¥–Ω–µ–π (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è).</p>
      </div>
      <div class="card">
        <div style="font-size:2rem">üí∞</div>
        <h3>–°–∏–º—É–ª—è—Ç–æ—Ä</h3>
        <p>–£—á–∏—Å—å –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ —Ä–∏—Å–∫—É—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏.</p>
      </div>
      <div class="card">
        <div style="font-size:2rem">üìö</div>
        <h3>–£—Ä–æ–∫–∏</h3>
        <p>–ö–æ—Ä–æ—Ç–∫–∏–µ —É—Ä–æ–∫–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏.</p>
      </div>
    </section>

    <section id="about" style="text-align:center;padding:2rem 1rem 4rem;">
      <h2 style="color:#102a66">–û –ø—Ä–æ–µ–∫—Ç–µ</h2>
      <p style="max-width:780px;margin:.6rem auto;color:#234569">AIvest ‚Äî —ç—Ç–æ —É—á–µ–±–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞: —Å–∏–º—É–ª—è—Ü–∏–∏, –≥—Ä–∞—Ñ–∏–∫–∏ –∏ AI-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–º–æ–≥—É—Ç —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –æ—Å–Ω–æ–≤–∞—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
    </section>
  </main>

  <footer id="contact">
    &copy; 2025 AIvest ‚Äî –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
  </footer>

  <!-- Floating emoji container : emojis will be appended to body -->
  <!-- CHAT UI -->
  <button class="chat-button" id="chatToggle" aria-label="–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç">üí¨</button>

  <div class="chat-window" id="chatWindow" role="dialog" aria-label="–ß–∞—Ç —Å AI" style="display:none; flex-direction:column;">
    <div class="chat-header">
      <div>AIvest Chat</div>
      <div class="controls">
        <button id="clearChat" class="tiny" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button id="closeChat" class="tiny" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

    <div class="chat-input">
      <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." aria-label="–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç">
      <button id="sendBtn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">‚û§</button>
    </div>
  </div>

  <script>
    /* -----------------------
       THEME: toggle + persistence
       ----------------------- */
    const themeToggle = document.getElementById('themeToggle');
    const THEME_KEY = 'aivest_theme'; // "dark" or "light"

    function applyTheme(theme){
      if(theme === 'dark'){
        document.body.classList.add('dark');
        themeToggle.textContent = '‚òÄÔ∏è';
      } else {
        document.body.classList.remove('dark');
        themeToggle.textContent = 'üåô';
      }
    }

    // init from storage
    const savedTheme = localStorage.getItem(THEME_KEY);
    applyTheme(savedTheme === 'dark' ? 'dark' : 'light');

    themeToggle.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
      themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    });

    /* -----------------------
       BURGER (mobile) menu
       ----------------------- */
    const burger = document.getElementById('burger');
    const navList = document.getElementById('navList');
    burger && burger.addEventListener('click', () => navList.classList.toggle('active'));

    /* -----------------------
       Typing effect (hero)
       ----------------------- */
    const typingEl = document.getElementById('typing');
    const phrases = [
      "–°–∏–º—É–ª—è—Ü–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π üöÄ",
      "AI-–ø—Ä–æ–≥–Ω–æ–∑—ã –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ üìà",
      "–£—á–∏—Å—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ ‚Äî –±–µ–∑ —Ä–∏—Å–∫–∞ üí°"
    ];
    let pIdx = 0, chIdx = 0, deleting = false;

    function typeLoop(){
      const current = phrases[pIdx];
      if(!deleting){
        chIdx++;
        typingEl.textContent = current.slice(0, chIdx);
        if(chIdx >= current.length){
          deleting = true;
          setTimeout(typeLoop, 1100);
          return;
        }
        setTimeout(typeLoop, 90 + Math.random()*60);
      } else {
        chIdx--;
        typingEl.textContent = current.slice(0, chIdx);
        if(chIdx <= 0){
          deleting = false;
          pIdx = (pIdx + 1) % phrases.length;
          setTimeout(typeLoop, 400);
          return;
        }
        setTimeout(typeLoop, 40 + Math.random()*40);
      }
    }
    typeLoop();

    /* -----------------------
       Floating emojis
       ----------------------- */
    const emojiList = ["üí∞","üìä","ü§ñ","üöÄ","üìà","üåü","üí°"];
    function spawnEmoji(){
      const el = document.createElement('div');
      el.className = 'emoji';
      el.textContent = emojiList[Math.floor(Math.random()*emojiList.length)];
      const size = 12 + Math.random()*28; // px font-size
      el.style.fontSize = size + 'px';
      const left = Math.random()*85 + 2; // vw
      el.style.left = left + 'vw';
      el.style.bottom = (-10 - Math.random()*20) + 'vh';
      el.style.opacity = 0;
      document.body.appendChild(el);

      // animate upward using transform & opacity
      const duration = 8000 + Math.random()*6000;
      el.animate([
        { transform: `translateY(0) scale(.95)`, opacity: 0 },
        { transform: `translateY(-120vh) scale(1.15)`, opacity: 1 }
      ], { duration: duration, easing: 'linear' });

      // remove after duration
      setTimeout(()=> el.remove(), duration + 200);
    }
    // spawn a few initially, then interval
    for(let i=0;i<3;i++) setTimeout(spawnEmoji, i*400);
    const emojiInterval = setInterval(spawnEmoji, 3000);

    /* -----------------------
       Chat: persistent messages (localStorage)
       ----------------------- */
    const CHAT_KEY = 'aivest_chat_messages_v1';
    const chatToggle = document.getElementById('chatToggle');
    const chatWindow = document.getElementById('chatWindow');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearChat');
    const closeBtn = document.getElementById('closeChat');

    // Load messages from storage (array of {sender:'user'|'bot', text, ts})
    function loadMessages(){
      try{
        const raw = localStorage.getItem(CHAT_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        if(!Array.isArray(arr)) return [];
        return arr;
      }catch(e){ console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–∞',e); return [] }
    }
    function saveMessages(arr){
      try{ localStorage.setItem(CHAT_KEY, JSON.stringify(arr)); }catch(e){ console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–∞',e); }
    }

    function renderMessages(){
      const msgs = loadMessages();
      chatMessages.innerHTML = '';
      msgs.forEach(m=>{
        const d = document.createElement('div');
        d.className = 'msg ' + (m.sender === 'user' ? 'user' : 'bot');
        d.textContent = m.text;
        // optional small timestamp
        const ts = document.createElement('div');
        ts.className = 'small';
        const time = new Date(m.ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        ts.textContent = time;
        d.appendChild(ts);
        chatMessages.appendChild(d);
      });
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // send user message
    function sendMessage(text){
      const trimmed = text && text.trim();
      if(!trimmed) return;
      const msgs = loadMessages();
      const userMsg = { sender:'user', text: trimmed, ts: Date.now() };
      msgs.push(userMsg);
      saveMessages(msgs);
      renderMessages();
      // simulate bot reply
      setTimeout(()=> botAnswer(trimmed), 700 + Math.random()*1000);
    }

    // simple bot logic (demo). Replace with API call logic later.
    function botAnswer(userText){
      const replies = [
        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –º–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.",
        "–°–æ–≤–µ—Ç: –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä—É–π –ø–æ—Ä—Ç—Ñ–µ–ª—å –∏ –Ω–µ –≤–∫–ª–∞–¥—ã–≤–∞–π –≤—Å—ë –≤ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é.",
        "–•–æ—á–µ—à—å –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –∞–∫—Ç–∏–≤—É? –ù–∞–∑–æ–≤–∏ —Ç–∏–∫–µ—Ä.",
        "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –Ω–∞—á–Ω–∏ —Å –º–∞–ª–æ–≥–æ –∏ –¥–µ—Ä–∂–∏ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç.",
        "–ü–æ–Ω–∏–º–∞—é. –ú–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è."
      ];
      // small rule: if user asks about forecast or ticker, respond accordingly
      const textLow = (userText || '').toLowerCase();
      let reply = replies[Math.floor(Math.random()*replies.length)];

      if(/\b(–ø—Ä–æ–≥–Ω–æ–∑|forecast|—Å–∫–æ–ª—å–∫–æ|–±—É–¥–µ—Ç|—á–µ—Ä–µ–∑)\b/.test(textLow)){
        reply = "–•–æ—Ä–æ—à–æ ‚Äî –º–æ–≥—É —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑, –Ω–æ –ø–æ–º–Ω–∏: —ç—Ç–æ —Ç–æ–ª—å–∫–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è.";
      } else if(/\b(bitcoin|btc|ethereum|eth|aapl|tsla|apple|tesla)\b/.test(textLow)){
        reply = "–í–∏–∂—É —Ç–∏–∫–µ—Ä ‚Äî –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ –≤ –¥–∞—à–±–æ—Ä–¥–µ (–¥–µ–º–æ).";
      }

      const msgs = loadMessages();
      msgs.push({ sender:'bot', text: reply, ts: Date.now() });
      saveMessages(msgs);
      renderMessages();
    }

    // wire buttons
    chatToggle.addEventListener('click', () => {
      const visible = chatWindow.style.display === 'flex';
      if(visible) {
        chatWindow.style.display = 'none';
      } else {
        chatWindow.style.display = 'flex';
        renderMessages();
        chatInput.focus();
      }
    });

    sendBtn.addEventListener('click', () => {
      sendMessage(chatInput.value);
      chatInput.value = '';
      chatInput.focus();
    });

    chatInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendBtn.click();
      }
    });

    clearBtn.addEventListener('click', () => {
      if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?')) return;
      localStorage.removeItem(CHAT_KEY);
      renderMessages();
    });

    closeBtn.addEventListener('click', ()=> chatWindow.style.display = 'none');

    // Ensure messages rendered if chat open from previous session
    document.addEventListener('DOMContentLoaded', ()=> {
      // If there are saved messages, show small badge on chat button
      const msgs = loadMessages();
      if(msgs.length > 0){
        // optional: small visual cue by slightly scaling button
        chatToggle.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.07)' }, { transform: 'scale(1)' }], { duration: 900, iterations: 1 });
      }
    });

    // initial render (invisible until open)
    renderMessages();

    /* ----------------------------
       IntersectionObserver for cards
       ---------------------------- */
    const observer = new IntersectionObserver((entries)=>{
      entries.forEach(ent=>{
        if(ent.isIntersecting) ent.target.classList.add('visible');
      });
    }, { threshold: 0.18 });

    document.querySelectorAll('.card').forEach(c=> observer.observe(c));

    /* Optional: graceful cleanup when leaving page (stop emoji spawner) */
    window.addEventListener('beforeunload', ()=> {
      clearInterval(); // no handle kept; not critical
    });

  </script>
</body>
</html>
